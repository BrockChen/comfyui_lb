INFO:     Started server process [82970]
INFO:     Waiting for application startup.
2025-12-21 14:26:39 [INFO] backend_manager: 注册后端: comfy-1 (http://192.168.2.9:8188)
2025-12-21 14:26:39 [INFO] backend_manager: 注册后端: comfy-2 (http://192.168.2.9:8189)
2025-12-21 14:26:39 [INFO] kong_manager: Kong 管理器已初始化: http://192.168.2.9:8001
2025-12-21 14:26:39 [INFO] __main__: Kong 管理器已启用: http://192.168.2.9:8001
2025-12-21 14:26:39 [INFO] health_checker: 健康检查已启动, 间隔: 5.0秒
2025-12-21 14:26:39 [INFO] task_queue: 任务队列已启动
2025-12-21 14:26:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:39 [INFO] backend_manager: 后端恢复健康: comfy-2
2025-12-21 14:26:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:39 [INFO] backend_manager: 后端恢复健康: comfy-1
2025-12-21 14:26:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:39 [INFO] __main__: ==================================================
2025-12-21 14:26:39 [INFO] __main__: ComfyUI 负载均衡器已启动
2025-12-21 14:26:39 [INFO] __main__: 监听地址: 0.0.0.0:8100
2025-12-21 14:26:39 [INFO] __main__: 管理界面: http://localhost:8100/
2025-12-21 14:26:39 [INFO] __main__: 后端数量: 2
2025-12-21 14:26:39 [INFO] __main__: 调度策略: least_busy
2025-12-21 14:26:39 [INFO] __main__: ==================================================
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8100 (Press CTRL+C to quit)
2025-12-21 14:26:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:53859 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:53859 - "GET /static/css/style.css HTTP/1.1" 200 OK
INFO:     127.0.0.1:53860 - "GET /static/js/app.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:53860 - "GET /lb/stats HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     127.0.0.1:53859 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     connection open
INFO:     127.0.0.1:53864 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     connection closed
INFO:     127.0.0.1:53864 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:53864 - "GET /favicon.ico HTTP/1.1" 404 Not Found
2025-12-21 14:26:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:53874 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:53875 - "GET /static/js/app.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:53874 - "GET /static/css/style.css HTTP/1.1" 200 OK
INFO:     127.0.0.1:53874 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:53875 - "GET /lb/tasks HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     127.0.0.1:53883 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:53883 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:53883 - "GET /favicon.ico HTTP/1.1" 404 Not Found
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:26:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:26:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:53917 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:53918 - "GET /lb/tasks HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     127.0.0.1:53922 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:53922 - "GET /lb/tasks HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:53982 - "GET /api/health HTTP/1.1" 404 Not Found
2025-12-21 14:27:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54018 - "GET /lb/stats HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:54042 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:54042 - "GET /static/css/style.css HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:54043 - "GET /static/js/app.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:54043 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:54042 - "GET /lb/tasks HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     127.0.0.1:54047 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:54047 - "GET /lb/tasks HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54206 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:54206 - "GET /static/css/style.css HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:54208 - "GET /static/js/app.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:54208 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:54206 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:54210 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     127.0.0.1:54210 - "GET /lb/tasks HTTP/1.1" 200 OK
2025-12-21 14:29:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54233 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-12-21 14:29:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:54305 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:54308 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:54309 - "GET /lb/scheduler HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54309 - "GET /lb/stats HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54309 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54308 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54309 - "GET /kong/services HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54312 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54305 - "GET /kong/plugins HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54305 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/dutao/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54305 - "GET /kong/consumers/dutao/key-auth HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/brock/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54305 - "GET /kong/consumers/brock/key-auth HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54911 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:54912 - "GET /static/js/app.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:54911 - "GET /static/css/style.css HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     127.0.0.1:54912 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:54911 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:54916 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     connection closed
INFO:     127.0.0.1:54916 - "GET /lb/tasks HTTP/1.1" 200 OK
2025-12-21 14:32:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:32:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54912 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:32:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
2025-12-21 14:32:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54912 - "GET /kong/services HTTP/1.1" 200 OK
INFO:     127.0.0.1:54916 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:32:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
2025-12-21 14:32:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54919 - "GET /kong/plugins HTTP/1.1" 200 OK
INFO:     127.0.0.1:54911 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:32:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:32:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54943 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:32:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54943 - "GET /kong/services HTTP/1.1" 200 OK
2025-12-21 14:32:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54948 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:32:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54949 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:32:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54950 - "GET /kong/plugins HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:56 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:56 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:01 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:01 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:06 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:06 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:11 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:11 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:16 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:16 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:55235 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:55238 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:55239 - "GET /lb/scheduler HTTP/1.1" 200 OK
INFO:     127.0.0.1:55239 - "GET /lb/stats HTTP/1.1" 200 OK
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55239 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55239 - "GET /kong/services HTTP/1.1" 200 OK
INFO:     127.0.0.1:55238 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55235 - "GET /kong/plugins HTTP/1.1" 200 OK
INFO:     127.0.0.1:55242 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55235 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/dutao/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55235 - "GET /kong/consumers/dutao/key-auth HTTP/1.1" 200 OK
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/brock/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55235 - "GET /kong/consumers/brock/key-auth HTTP/1.1" 200 OK
2025-12-21 14:34:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:56 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:56 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:35:01 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:01 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:35:06 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:06 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:35:11 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:11 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:35:16 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:16 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:35:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:35:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:35:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:35:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:35:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:35:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:55370 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:55372 - "GET /static/js/app.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:55370 - "GET /static/css/style.css HTTP/1.1" 304 Not Modified
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:55370 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:55372 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:55376 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     127.0.0.1:55376 - "GET /lb/tasks HTTP/1.1" 200 OK
2025-12-21 14:35:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:35:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55372 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:35:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55372 - "GET /kong/services HTTP/1.1" 200 OK
2025-12-21 14:35:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
2025-12-21 14:35:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
2025-12-21 14:35:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55379 - "GET /kong/plugins HTTP/1.1" 200 OK
INFO:     127.0.0.1:55370 - "GET /kong/consumers HTTP/1.1" 200 OK
INFO:     127.0.0.1:55376 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:35:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:35:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55376 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:35:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55376 - "GET /kong/services HTTP/1.1" 200 OK
2025-12-21 14:35:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55379 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:35:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55370 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:35:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55372 - "GET /kong/plugins HTTP/1.1" 200 OK
2025-12-21 14:35:56 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:35:56 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:36:01 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:01 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:36:06 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:06 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:36:11 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:11 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:36:16 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:16 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:36:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:36:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:55467 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:55468 - "GET /static/js/app.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:55467 - "GET /static/css/style.css HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:36:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:36:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:36:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:36:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:36:56 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:36:56 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:37:01 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:37:01 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:37:06 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:37:06 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:37:11 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:37:11 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:37:16 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:37:16 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:37:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:37:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:37:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:37:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:37:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:37:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:37:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:37:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:37:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:37:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:37:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:37:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:37:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:37:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:37:56 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:37:56 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:38:01 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:01 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:38:06 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:06 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:38:11 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:11 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:38:16 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:16 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:38:22 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:22 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:38:27 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:27 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:32 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:32 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:38:37 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:37 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:38:42 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:42 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:38:47 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:47 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:38:52 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:52 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:38:57 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:38:57 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:39:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:39:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:39:07 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:39:07 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:39:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:39:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:39:17 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:39:17 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:39:22 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:39:22 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:39:27 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:39:27 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:39:32 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:39:32 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:39:37 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:39:37 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:39:42 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:39:42 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:39:47 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:39:47 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:55847 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:55850 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:55851 - "GET /lb/scheduler HTTP/1.1" 200 OK
INFO:     127.0.0.1:55851 - "GET /lb/stats HTTP/1.1" 200 OK
2025-12-21 14:39:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:39:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55851 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:39:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55854 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:39:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55851 - "GET /kong/services HTTP/1.1" 200 OK
2025-12-21 14:39:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55847 - "GET /kong/plugins HTTP/1.1" 200 OK
2025-12-21 14:39:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55850 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:39:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55854 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:39:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/dutao/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55854 - "GET /kong/consumers/dutao/key-auth HTTP/1.1" 200 OK
2025-12-21 14:39:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/brock/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55854 - "GET /kong/consumers/brock/key-auth HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:39:52 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:39:52 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:39:57 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:39:57 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:40:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:40:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:40:07 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:40:07 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:40:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:40:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:40:17 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:40:17 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:40:22 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:40:22 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:40:27 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:40:27 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:55937 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:55938 - "GET /static/js/app.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:55937 - "GET /static/css/style.css HTTP/1.1" 304 Not Modified
2025-12-21 14:40:32 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:40:32 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:40:37 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:40:37 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:40:42 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:40:42 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:40:47 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:40:47 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:40:52 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:40:52 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:40:57 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:40:57 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:41:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:41:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:41:07 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:41:07 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:41:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:41:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:41:17 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:41:17 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:41:22 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:41:22 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:41:27 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:41:27 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:41:32 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:41:32 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:41:37 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:41:37 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:41:42 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:41:42 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:41:47 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:41:47 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:41:52 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:41:52 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:41:57 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:41:57 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:42:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:42:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:42:07 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:42:07 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:42:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:42:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:42:17 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:42:17 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:42:22 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:42:22 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:42:27 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:42:27 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:42:32 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:42:32 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:42:37 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:42:37 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:42:42 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:42:42 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:42:47 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:42:47 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:42:52 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:42:52 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:42:57 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:42:57 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:43:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:43:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:43:07 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:43:07 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:43:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:43:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:43:17 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:43:17 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:43:22 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:43:22 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:43:27 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:43:27 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:43:32 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:43:32 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:56321 - "GET /static/js/app.js HTTP/1.1" 304 Not Modified
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:43:37 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:43:37 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:43:42 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:43:42 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:43:47 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:43:47 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:43:52 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:43:52 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:43:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:43:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:44:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:44:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:44:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:44:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:44:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:44:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:44:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:44:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:44:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:44:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:44:28 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:44:28 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:44:33 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:44:33 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:44:38 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:44:38 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:44:43 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:44:43 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:44:48 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:44:48 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:56460 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:56462 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:56464 - "GET /lb/scheduler HTTP/1.1" 200 OK
INFO:     127.0.0.1:56464 - "GET /lb/stats HTTP/1.1" 200 OK
2025-12-21 14:44:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:44:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:56464 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:44:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:56462 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:44:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
2025-12-21 14:44:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:56464 - "GET /kong/services HTTP/1.1" 200 OK
INFO:     127.0.0.1:56467 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:44:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
INFO:     127.0.0.1:56460 - "GET /kong/plugins HTTP/1.1" 200 OK
2025-12-21 14:44:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:56460 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:44:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/dutao/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:56460 - "GET /kong/consumers/dutao/key-auth HTTP/1.1" 200 OK
2025-12-21 14:44:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/brock/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:56460 - "GET /kong/consumers/brock/key-auth HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:44:53 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:44:53 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:44:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:44:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:45:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:45:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:45:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:45:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:45:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:45:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:45:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:45:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:45:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:45:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:45:28 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:45:28 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:45:33 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:45:33 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:45:38 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:45:38 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:45:43 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:45:43 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:45:48 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:45:48 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:45:53 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:45:53 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:45:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:45:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:46:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:46:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:46:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:46:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:46:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:46:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:46:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:46:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:46:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:46:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:46:28 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:46:28 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:46:33 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:46:33 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:46:38 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:46:38 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:46:43 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:46:43 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:46:48 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:46:48 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:46:53 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:46:53 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:46:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:46:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:47:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:47:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:47:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:47:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:47:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:47:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:56739 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:56740 - "GET /static/js/app.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:56739 - "GET /static/css/style.css HTTP/1.1" 304 Not Modified
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:47:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:47:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:47:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:47:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:47:28 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:47:28 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:47:33 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:47:33 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:47:38 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:47:38 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:47:43 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:47:43 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:47:48 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:47:48 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:56804 - "GET /lb/stats HTTP/1.1" 200 OK
2025-12-21 14:47:53 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:47:53 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:47:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:47:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:48:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:48:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:48:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:48:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:48:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:28 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:48:28 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:33 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:48:33 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:38 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:48:38 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:48:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:56882 - "GET /kong/status HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:43 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:48:43 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:48 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:48:48 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:53 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:48:53 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:48:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:48:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:49:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:49:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:49:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:49:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:49:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:49:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:49:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:49:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:49:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:49:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:49:28 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:49:28 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:49:33 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:49:33 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:49:38 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:49:38 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:49:43 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:49:43 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:49:48 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:49:48 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57004 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:57006 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:57004 - "GET /lb/scheduler HTTP/1.1" 200 OK
INFO:     127.0.0.1:57004 - "GET /lb/stats HTTP/1.1" 200 OK
2025-12-21 14:49:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:49:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57004 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:49:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57008 - "GET /kong/plugins HTTP/1.1" 200 OK
2025-12-21 14:49:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57004 - "GET /kong/services HTTP/1.1" 200 OK
2025-12-21 14:49:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57006 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:49:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57011 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:49:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57011 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:49:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/dutao/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57011 - "GET /kong/consumers/dutao/key-auth HTTP/1.1" 200 OK
2025-12-21 14:49:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/brock/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57011 - "GET /kong/consumers/brock/key-auth HTTP/1.1" 200 OK
2025-12-21 14:49:53 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:49:53 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:49:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:49:58 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:50:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:50:03 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:50:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:50:08 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:50:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:50:13 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:50:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:50:18 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:50:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:50:23 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:50:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:50:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:50:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:50:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:50:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:50:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:50:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:50:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:50:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:50:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:50:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:50:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:50:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:50:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:51:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:51:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:51:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:51:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:51:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:51:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:51:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:51:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:51:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:51:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:51:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:51:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:51:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:51:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:51:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:51:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:51:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:51:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:51:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:51:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:51:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:51:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57257 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:57257 - "GET /static/css/style.css HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:57259 - "GET /static/js/app.js HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:51:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:51:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:52:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:52:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:52:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:52:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57294 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-12-21 14:52:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:52:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:52:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:52:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:52:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:52:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:52:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:52:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:52:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:52:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57376 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:57376 - "GET /static/js/app.js HTTP/1.1" 304 Not Modified
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:57376 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:57376 - "GET / HTTP/1.1" 200 OK
2025-12-21 14:52:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:52:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:52:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:52:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:52:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:52:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:52:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:52:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57378 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:57378 - "GET /static/js/app.js HTTP/1.1" 304 Not Modified
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:52:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:52:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:53:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:53:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:53:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:57414 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:57476 - "GET /static/js/app.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:57414 - "GET /static/css/style.css HTTP/1.1" 200 OK
2025-12-21 14:53:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:53:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57486 - "GET / HTTP/1.1" 200 OK
2025-12-21 14:53:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:53:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57552 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:57553 - "GET /static/js/app.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:57552 - "GET /static/css/style.css HTTP/1.1" 304 Not Modified
2025-12-21 14:54:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57575 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:57577 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:57575 - "GET /lb/scheduler HTTP/1.1" 200 OK
INFO:     127.0.0.1:57575 - "GET /lb/stats HTTP/1.1" 200 OK
2025-12-21 14:54:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:54:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57575 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:54:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57579 - "GET /kong/plugins HTTP/1.1" 200 OK
2025-12-21 14:54:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57575 - "GET /kong/services HTTP/1.1" 200 OK
2025-12-21 14:54:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
2025-12-21 14:54:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57577 - "GET /kong/routes HTTP/1.1" 200 OK
INFO:     127.0.0.1:57582 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:54:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57582 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:54:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/dutao/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57582 - "GET /kong/consumers/dutao/key-auth HTTP/1.1" 200 OK
2025-12-21 14:54:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/brock/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57582 - "GET /kong/consumers/brock/key-auth HTTP/1.1" 200 OK
2025-12-21 14:54:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:54:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:55:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:57709 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:57710 - "GET /static/js/app.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:57709 - "GET /static/css/style.css HTTP/1.1" 304 Not Modified
2025-12-21 14:56:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:56:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:57:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
