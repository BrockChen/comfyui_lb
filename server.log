INFO:     Started server process [82970]
INFO:     Waiting for application startup.
2025-12-21 14:26:39 [INFO] backend_manager: 注册后端: comfy-1 (http://192.168.2.9:8188)
2025-12-21 14:26:39 [INFO] backend_manager: 注册后端: comfy-2 (http://192.168.2.9:8189)
2025-12-21 14:26:39 [INFO] kong_manager: Kong 管理器已初始化: http://192.168.2.9:8001
2025-12-21 14:26:39 [INFO] __main__: Kong 管理器已启用: http://192.168.2.9:8001
2025-12-21 14:26:39 [INFO] health_checker: 健康检查已启动, 间隔: 5.0秒
2025-12-21 14:26:39 [INFO] task_queue: 任务队列已启动
2025-12-21 14:26:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:39 [INFO] backend_manager: 后端恢复健康: comfy-2
2025-12-21 14:26:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:39 [INFO] backend_manager: 后端恢复健康: comfy-1
2025-12-21 14:26:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:39 [INFO] __main__: ==================================================
2025-12-21 14:26:39 [INFO] __main__: ComfyUI 负载均衡器已启动
2025-12-21 14:26:39 [INFO] __main__: 监听地址: 0.0.0.0:8100
2025-12-21 14:26:39 [INFO] __main__: 管理界面: http://localhost:8100/
2025-12-21 14:26:39 [INFO] __main__: 后端数量: 2
2025-12-21 14:26:39 [INFO] __main__: 调度策略: least_busy
2025-12-21 14:26:39 [INFO] __main__: ==================================================
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8100 (Press CTRL+C to quit)
2025-12-21 14:26:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:53859 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:53859 - "GET /static/css/style.css HTTP/1.1" 200 OK
INFO:     127.0.0.1:53860 - "GET /static/js/app.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:53860 - "GET /lb/stats HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     127.0.0.1:53859 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     connection open
INFO:     127.0.0.1:53864 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     connection closed
INFO:     127.0.0.1:53864 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:53864 - "GET /favicon.ico HTTP/1.1" 404 Not Found
2025-12-21 14:26:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:53874 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:53875 - "GET /static/js/app.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:53874 - "GET /static/css/style.css HTTP/1.1" 200 OK
INFO:     127.0.0.1:53874 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:53875 - "GET /lb/tasks HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     127.0.0.1:53883 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:53883 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:53883 - "GET /favicon.ico HTTP/1.1" 404 Not Found
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:26:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:26:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:26:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:04 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:53917 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:53918 - "GET /lb/tasks HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     127.0.0.1:53922 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:53922 - "GET /lb/tasks HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:09 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:14 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:19 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:24 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:53982 - "GET /api/health HTTP/1.1" 404 Not Found
2025-12-21 14:27:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:29 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:34 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:39 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54018 - "GET /lb/stats HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:44 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:49 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:54042 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:54042 - "GET /static/css/style.css HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:54043 - "GET /static/js/app.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:54043 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:54042 - "GET /lb/tasks HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     127.0.0.1:54047 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:54047 - "GET /lb/tasks HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:54 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:27:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:27:59 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:28:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:28:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54206 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:54206 - "GET /static/css/style.css HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:54208 - "GET /static/js/app.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:54208 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:54206 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:54210 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     127.0.0.1:54210 - "GET /lb/tasks HTTP/1.1" 200 OK
2025-12-21 14:29:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54233 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-12-21 14:29:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:54305 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:54308 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:54309 - "GET /lb/scheduler HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54309 - "GET /lb/stats HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54309 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54308 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54309 - "GET /kong/services HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54312 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54305 - "GET /kong/plugins HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54305 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/dutao/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54305 - "GET /kong/consumers/dutao/key-auth HTTP/1.1" 200 OK
2025-12-21 14:29:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/brock/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54305 - "GET /kong/consumers/brock/key-auth HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:29:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:29:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:30:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:30:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:31:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:31:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54911 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:54912 - "GET /static/js/app.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:54911 - "GET /static/css/style.css HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     127.0.0.1:54912 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:54911 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:54916 - "GET /lb/backends HTTP/1.1" 200 OK
INFO:     connection closed
INFO:     127.0.0.1:54916 - "GET /lb/tasks HTTP/1.1" 200 OK
2025-12-21 14:32:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:32:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54912 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:32:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
2025-12-21 14:32:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54912 - "GET /kong/services HTTP/1.1" 200 OK
INFO:     127.0.0.1:54916 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:32:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
2025-12-21 14:32:02 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54919 - "GET /kong/plugins HTTP/1.1" 200 OK
INFO:     127.0.0.1:54911 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:32:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:32:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54943 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:32:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54943 - "GET /kong/services HTTP/1.1" 200 OK
2025-12-21 14:32:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54948 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:32:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54949 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:32:12 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
INFO:     127.0.0.1:54950 - "GET /kong/plugins HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:20 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:25 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:30 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:35 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:40 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:45 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:32:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:32:55 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:00 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:05 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:10 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:15 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:33:56 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:33:56 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:01 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:01 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:06 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:06 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:11 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:11 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:16 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:16 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:21 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:26 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:31 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:36 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
2025-12-21 14:34:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:41 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:46 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 686, in __getattr__
    return self._state[key]
KeyError: 'ws_manager'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 143, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 140, in app
    await func(session)
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 507, in app
    await dependant.call(**solved_result.values)
  File "/Users/aa01035/work/mcode/comfyui_lb/main.py", line 183, in ws_endpoint
    await websocket_endpoint(websocket, clientId)
  File "/Users/aa01035/work/mcode/comfyui_lb/api/websocket.py", line 150, in websocket_endpoint
    manager = app.state.ws_manager
  File "/Users/aa01035/Library/Python/3.9/lib/python/site-packages/starlette/datastructures.py", line 689, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'ws_manager'
INFO:     connection open
INFO:     connection closed
INFO:     127.0.0.1:55235 - "GET /lb/stats HTTP/1.1" 200 OK
INFO:     127.0.0.1:55238 - "GET /lb/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:55239 - "GET /lb/scheduler HTTP/1.1" 200 OK
INFO:     127.0.0.1:55239 - "GET /lb/stats HTTP/1.1" 200 OK
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/ "HTTP/1.1 200 OK"
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/status "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55239 - "GET /kong/status HTTP/1.1" 200 OK
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/services "HTTP/1.1 200 OK"
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/routes "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55239 - "GET /kong/services HTTP/1.1" 200 OK
INFO:     127.0.0.1:55238 - "GET /kong/routes HTTP/1.1" 200 OK
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/plugins "HTTP/1.1 200 OK"
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55235 - "GET /kong/plugins HTTP/1.1" 200 OK
INFO:     127.0.0.1:55242 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55235 - "GET /kong/consumers HTTP/1.1" 200 OK
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/dutao/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55235 - "GET /kong/consumers/dutao/key-auth HTTP/1.1" 200 OK
2025-12-21 14:34:50 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8001/consumers/brock/key-auth "HTTP/1.1 200 OK"
INFO:     127.0.0.1:55235 - "GET /kong/consumers/brock/key-auth HTTP/1.1" 200 OK
2025-12-21 14:34:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8188/queue "HTTP/1.1 200 OK"
2025-12-21 14:34:51 [INFO] httpx: HTTP Request: GET http://192.168.2.9:8189/queue "HTTP/1.1 200 OK"
